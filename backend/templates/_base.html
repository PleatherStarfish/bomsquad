{% load static %}
{% load custom_tags %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KXVV479GJX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-KXVV479GJX');
    </script>
    <meta charset="utf-8" />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width,minimum-scale=1,initial-scale=1"
    />
    <meta name="description" content="{% block meta_description %}Build DIY guitar pedals, modular synth kits, and Eurorack projects with BOM Squad. Access schematics, inventory tools, and community reviews to streamline your builds.{% endblock meta_description %}" />
    <meta name="keywords" content="{% block keywords %}diy guitar pedals, diy modular synth, diy eurorack, diy modular synth schematics, diy modular synth kit{% endblock keywords %}" />
    
    <title>{% block title %}BOM Squad | DIY Synthesizer Project Tool{% endblock title %}</title>
    <meta
      name="author"
      content="https://github.com/PleatherStarfish/bomsquad"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="{% static 'images/logo.png' %}"
    />
    <link rel="canonical" href="{{ request.build_absolute_uri|force_https_and_remove_trailing_slash }}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/cash-dom/dist/cash.min.js"></script>
    <script>(function(){const{protocol:n,host:o,pathname:t,search:a,hash:h}=window.location;t.endsWith("/")||t.endsWith(".html")||window.location.replace(`${n}//${o}${t}/${a}${h}`)})()</script>
    <script src="https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
    <script src="https://unpkg.com/@popperjs/core@2" defer></script>
    <script src="https://unpkg.com/tippy.js@6" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js" defer></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1549230942850511"
     crossorigin="anonymous"></script>
     <link
        rel="preload"
        as="style"
        href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
      />
      <!-- Include Choices.js JavaScript from CDN -->
      <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"  defer></script>
      <script src="https://cdn.jsdelivr.net/npm/motion@11.11.13/dist/motion.js" defer></script>
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1549230942850511" crossorigin="anonymous"></script>
      <script type="text/javascript">
        (function (f, b) { if (!b.__SV) { var e, g, i, h; window.mixpanel = b; b._i = []; b.init = function (e, f, c) { function g(a, d) { var b = d.split("."); 2 == b.length && ((a = a[b[0]]), (d = b[1])); a[d] = function () { a.push([d].concat(Array.prototype.slice.call(arguments, 0))); }; } var a = b; "undefined" !== typeof c ? (a = b[c] = []) : (c = "mixpanel"); a.people = a.people || []; a.toString = function (a) { var d = "mixpanel"; "mixpanel" !== c && (d += "." + c); a || (d += " (stub)"); return d; }; a.people.toString = function () { return a.toString(1) + ".people (stub)"; }; i = "disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split( " "); for (h = 0; h < i.length; h++) g(a, i[h]); var j = "set set_once union unset remove delete".split(" "); a.get_group = function () { function b(c) { d[c] = function () { call2_args = arguments; call2 = [c].concat(Array.prototype.slice.call(call2_args, 0)); a.push([e, call2]); }; } for ( var d = {}, e = ["get_group"].concat( Array.prototype.slice.call(arguments, 0)), c = 0; c < j.length; c++) b(j[c]); return d; }; b._i.push([e, f, c]); }; b.__SV = 1.2; e = f.createElement("script"); e.type = "text/javascript"; e.async = !0; e.src = "undefined" !== typeof MIXPANEL_CUSTOM_LIB_URL ? MIXPANEL_CUSTOM_LIB_URL : "file:" === f.location.protocol && "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//) ? "https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js" : "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js"; g = f.getElementsByTagName("script")[0]; g.parentNode.insertBefore(e, g); } })(document, window.mixpanel || []);
      </script>
      <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "pjqgdeeok7");
      </script>
      <script></script>

    {% block css %}{% endblock css %}
  </head>

  <body class="min-h-screen">
    <header>{% include "nav.html" %}</header>
    <div id="currency-container" data-is-authenticated="{{ request.user.is_authenticated|yesno:'true,false' }}" data-default-currency="{{ request.user.default_currency|default:'' }}" data-csrf-token="{{ csrf_token }}" data-url-user-currency="{% url 'user_currency' %}"></div>

    <!-- Cookie Consent -->
    <div id="cookie-consent-banner" class="fixed z-50 hidden max-w-sm transition-all transform bg-gray-600 rounded-lg shadow-lg bottom-4 right-4 sm:bottom-6 sm:right-6">
      <div class="p-6">
          <div class="sm:flex sm:items-start">
              <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                  <h3 class="text-lg font-medium leading-6 text-white">Cookie Consent</h3>
                  <p class="mt-2 text-sm text-white">
                      We use cookies to enhance your browsing experience. Please accept or deny to proceed.
                  </p>
              </div>
          </div>
          <div class="mt-5 sm:mt-4 sm:flex sm:justify-end">
              <button style="background: #13c3ff" id="allow-cookies" class="inline-flex justify-center w-full px-3 py-2 text-sm font-semibold text-white bg-[#13c3ff] rounded-md shadow-sm hover:bg-blue-500 sm:w-auto">
                  Accept
              </button>
              <button id="deny-cookies" class="inline-flex justify-center w-full px-3 py-2 mt-3 text-sm font-semibold text-gray-700 bg-gray-300 rounded-md shadow-sm hover:bg-gray-400 sm:ml-3 sm:mt-0 sm:w-auto">
                  Deny
              </button>
          </div>
      </div>
    </div>

    <div class="flex flex-col min-h-screen">
      {% with request.path|slice:":5" as path %}
      <div
        class="{% if path == '/user' %}w-screen grow{% else %}mb-12 mt-36 py-8 px-4 md:px-24 lg:px-48 grow{% endif %}"
      >
        {% if path != '/' and path != '/user' and path != '/abou' and path != '/acco' and path != '/faq' and path != '/tos' and path != '/tool' %}
        <div id="banner-modal" class="relative z-40 hidden" aria-labelledby="banner-title" role="dialog" aria-modal="true">
          <!-- Modal backdrop -->
          <div class="fixed inset-0 transition-opacity bg-gray-500/75" aria-hidden="true"></div>
        
          <!-- Modal content -->
          <div class="fixed inset-0 z-50 flex items-center justify-center overflow-y-auto]">
            <div class="relative flex flex-col w-full gap-4 p-8 px-6 pt-5 pb-6 mx-6 overflow-hidden transition-all transform rounded-lg md:p-12 bg-gray-50 sm:w-full md:max-w-2xl lg:max-w-3xl md:mx-0">
              <div>
                <!-- Modal Header -->
                <h3 class="mb-6 text-5xl text-gray-500 font-display" id="banner-title">Not seeing your project here?</h3>
                <!-- Modal Content -->
                <div class="mt-2 text-gray-500 text-md">
                  BOM Squad is an <a class="text-blue-500 hover:text-blue-700" href="https://github.com/PleatherStarfish/bomsquad" target="_blank">open-source</a> tool built and maintained by hobbyists. Subscribe and support the project on <a class="text-blue-500 hover:text-blue-700" href="https://ko-fi.com/bomsquad" target="_blank">Ko-fi</a> (a Patreon-type social funding platform), and you get to choose which project we add next! (Usually within 48 hours.)
                </div>
              </div>
              <!-- Modal Actions -->
              <div class="flex flex-col w-full gap-3 mt-5 sm:mt-4 md:flex-row md:justify-end md:items-center">
                <!-- Button 1 -->
                <button
                  id="banner-hide-button"
                  type="button"
                  class="inline-flex items-center justify-center w-full px-4 py-2 text-sm font-semibold text-white bg-gray-400 rounded-md shadow-sm hover:bg-gray-500 sm:w-auto h-[41px] whitespace-nowrap"
                >
                  Sorry, I can't support right now
                </button>
                <!-- Button 2 -->
                <button
                  type="button"
                  onclick="window.open('https://ko-fi.com/bomsquad', '_blank')"
                  class="inline-flex items-center justify-center w-full px-4 py-2 text-sm font-semibold text-white bg-[#13c3ff] rounded-md shadow-sm hover:bg-sky-600 md:ml-2 sm:w-auto h-[41px] whitespace-nowrap"
                >
                  <iframe
                    src="https://giphy.com/embed/kgKFcQk6oa1WIdHNSl"
                    width="25"
                    height="25"
                    class="mr-2"
                    frameborder="0"
                    allowfullscreen
                  ></iframe>
                  Support BOM Squad
                </button>
              </div>
              
            </div>
          </div>
        </div>
        {% endif %}
        {% block content %}{% endblock content %}
      </div>
      {% if path != '/projects' and path != '/user' %}
      <footer>{% include "footer.html" %}</footer>
      {% endif %}
      {% endwith %}
    </div>

    <script data-cookiecategory="analytics" type=\"text/javascript\" defer>\n(function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(\".\");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;\"undefined\"!==typeof c?a=b[c]=[]:c=\"mixpanel\";a.people=a.people||[];a.toString=function(a){var d=\"mixpanel\";\"mixpanel\"!==c&&(d+=\".\"+c);a||(d+=\" (stub)\");return d};a.people.toString=function(){return a.toString(1)+\".people (stub)\"};i=\"disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove\".split(\" \");\nfor(h=0;h<i.length;h++)g(a,i[h]);var j=\"set set_once union unset remove delete\".split(\" \");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=[\"get_group\"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement(\"script\");e.type=\"text/javascript\";e.async=!0;e.src=\"undefined\"!==typeof MIXPANEL_CUSTOM_LIB_URL?\nMIXPANEL_CUSTOM_LIB_URL:\"file:\"===f.location.protocol&&\"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\".match(/^\\/\\//)?\"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\":\"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\";g=f.getElementsByTagName(\"script\")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);\n</script>
    <script src="{% static 'js/toggle_dropdown.js' %}" defer></script>
    <script src="{% static 'js/mobile_menu.js' %}" defer></script>
    <script src="{% static 'js/logo_shrink.js' %}" defer></script>
    <script src="{% static 'js/hide_toast_notifications.js' %}" defer></script>
    <script src="{% static 'js/banner.js' %}" defer></script> 
    <script src="{% static 'js/mobile_dropdown_toggle.js' %}" defer></script> 

    <script>
      function updateCurrency(newCurrency) {
        localStorage.setItem("currency", newCurrency);
    
        const isAuthenticated = {{ request.user.is_authenticated|yesno:"true,false" }};
        
        // Update user's default currency on the server if authenticated
        if (isAuthenticated) {
          fetch("{% url 'user_currency' %}", {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": "{{ csrf_token|escapejs }}", // Include CSRF token safely
            },
            body: JSON.stringify({ default_currency: newCurrency }),
          })
            .then((response) => {
              console.log("Response status:", response.status); // Debug response status
              if (response.ok || response.status === 403) {
                console.log("Reloading page...");
                window.location.replace(window.location.href); // Force reload
              } else {
                console.error("Error updating currency:", response.statusText);
              }
            })
            .catch((error) => {
              console.error("Network error:", error);
              window.location.replace(window.location.href); // Reload on error
            });
        } else {
          console.log("User not authenticated, reloading...");
          window.location.replace(window.location.href); // Reload for unauthenticated users
        }
      }
    
      $(document).ready(function () {
        const currencies = [
          { code: "USD", symbol: "$", name: "US Dollar" },
          { code: "EUR", symbol: "€", name: "Euro" },
          { code: "JPY", symbol: "¥", name: "Japanese Yen" },
          { code: "GBP", symbol: "£", name: "British Pound" },
          { code: "AUD", symbol: "A$", name: "Australian Dollar" },
          { code: "CAD", symbol: "C$", name: "Canadian Dollar" },
          { code: "CHF", symbol: "CHF", name: "Swiss Franc" },
          { code: "CNY", symbol: "¥", name: "Chinese Yuan" },
          { code: "HKD", symbol: "HK$", name: "Hong Kong Dollar" },
          { code: "NZD", symbol: "NZ$", name: "New Zealand Dollar" },
          { code: "SEK", symbol: "kr", name: "Swedish Krona" },
          { code: "KRW", symbol: "₩", name: "South Korean Won" },
          { code: "SGD", symbol: "S$", name: "Singapore Dollar" },
          { code: "NOK", symbol: "kr", name: "Norwegian Krone" },
          { code: "INR", symbol: "₹", name: "Indian Rupee" },
        ];
    
        const currencySelector = $("#currency-selector");
    
        function getDefaultCurrency() {
          const userDefaultCurrency = "{{ request.user.default_currency|escapejs|default:'' }}";
          const isAuthenticated = {{ request.user.is_authenticated|yesno:"true,false" }};
          if (isAuthenticated && userDefaultCurrency) {
            return userDefaultCurrency;
          }
          return localStorage.getItem("currency") || "USD";
        }
    
        function populateWithSymbols() {
          currencySelector.empty();
          currencies.forEach((currency) => {
            const option = $("<option>")
              .val(currency.code)
              .text(currency.symbol);
            currencySelector.append(option);
          });
          currencySelector.val(getDefaultCurrency());
        }
    
        function populateWithFullNames() {
          currencySelector.empty();
          currencies.forEach((currency) => {
            const option = $("<option>")
              .val(currency.code)
              .text(`${currency.name} (${currency.code})`);
            currencySelector.append(option);
          });
          currencySelector.val(getDefaultCurrency());
        }
    
        currencySelector.on("focus", populateWithFullNames);
        currencySelector.on("blur", populateWithSymbols);
        populateWithSymbols();
    
        currencySelector.on("change", function () {
          updateCurrency(this.value);
        });
      });
    </script>    
    
    {% block javascript %}{% endblock javascript %}
  </body>
</html>
