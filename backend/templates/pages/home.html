{% extends '_base.html' %} 
{% load static %} 

{% block title %} BOM Squad: A Tool
for DIY Guitar Pedals, Modular Synth Kits, Eurorack Projects, and DIY Eurorack
{% endblock title %} 

{% block content %}
<div class="p-0 homepage-grid">
  <!-- Header Section with Circuit Board Image Background -->
  <div
    id="parallax-container"
    class="relative w-full h-[295px] lg:h-[408px] header-section overflow-hidden border border-gray-300"
  >
    <picture>
      <source
        srcset="{% static 'images/circuit-board-small.webp' %}"
        type="image/webp"
      />
      <source
        srcset="{% static 'images/circuit-board-small.jpg' %}"
        type="image/jpg"
      />
      <img
        style="max-width: none"
        id="parallax-image"
        src="{% static 'images/circuit-board-small.webp' %}"
        alt="Circuit board background"
        class="object-custom-center"
        loading="eager"
      />
    </picture>
    <div
      style="opacity: 0.85"
      class="absolute inset-0 flex items-center justify-center h-screen bg-white"
    ></div>
    <div class="absolute inset-0 flex items-center justify-center">
      <div class="max-w-[290px] sm:max-w-[400px] md:max-w-[600px]">
        <h2
          class="text-xl font-semibold text-center text-gray-900 md:text-5xl bold font-display"
        >
          <span>The only BOM tool built by and for DIY </span
          ><span
            id="audio-jiggle"
            style="
              display: inline-block;
              transform-origin: center;
              will-change: transform;
            "
            >audio</span
          ><span> hardware geeks</span>
        </h2>
        <div class="mt-6">
          <p
            class="font-normal text-center text-gray-600 md:text-lg font-display"
          >
            An interactive bill of materials (BOMs) that intelligently
            cross-reference with your inventory and shopping list
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Projects Section -->
  <div class="flex flex-col border-gray-300 border-x projects-section">
    <div class="flex flex-col justify-between">
      <div style="padding: 1.5rem" class="w-full p-6 min-h-80 md:h-full">
        <h2 class="mb-4 text-2xl font-semibold text-left font-display">
          Recently Added
        </h2>
        <div class="w-full my-3">
          <p
            style="font-size: 16px"
            class="font-medium text-left text-gray-600 font-display"
          >
            Projects recently added to the BOM Squad database. Support the
            project on
            <a class="text-blue-500" href="https://ko-fi.com/bomsquad">Ko-Fi</a>
            and choose what we add next!
          </p>
        </div>
      </div>
      <div class="relative py-2 overflow-hidden">
        <svg
          width="100%"
          height="1"
          style="position: absolute; top: 0; left: 0"
        >
          <line
            x1="0"
            y1="0.5"
            x2="100%"
            y2="0.5"
            stroke="#9ca3af"
            stroke-width="1"
            stroke-dasharray="8, 16"
          />
        </svg>
      </div>
    </div>
    <ul class="flex flex-col justify-around h-full px-6 md:flex-row">
      {% for project in projects %}
      <li
        class="flex flex-col items-center justify-around py-10 space-y-4 max-w-min md:space-y-0 md:justify-start md:flex-row md:border-0"
      >
        <div
          class="flex justify-center w-20 h-20 mr-4 overflow-hidden align-middle rounded lg:w-20 lg:h-20"
        >
          <div class="flex justify-center w-full h-full align-middle md:w-auto">
            <a href="{{ project.module_url }}">
              <picture>
                <source srcset="{{ project.thumbnail }}" type="image/webp" />
                <img
                  src="{{ project.thumbnail }}"
                  alt="{{ project.title }} thumbnail"
                  class="object-contain w-auto h-full"
                />
              </picture>
            </a>
          </div>
        </div>
        <div class="text-center md:text-left">
          <h3 class="text-lg font-semibold">
            <a href="{{ project.module_url }}">{{ project.title }}</a>
          </h3>
          <p class="text-sm text-gray-600">
            by
            <a
              href="{{ project.manufacturer_url }}"
              class="text-blue-600 hover:underline"
              >{{ project.manufacturer }}</a
            >
          </p>
        </div>
      </li>
      {% empty %}
      <li class="py-2 text-gray-500">No projects found.</li>
      {% endfor %}
    </ul>
  </div>

  <a href="/projects/" class="block left-info-box">
    <div
      style="padding: 1.5rem"
      class="relative flex flex-col justify-center w-full p-6 border-t border-b border-gray-200 border-x md:border h-52 lg:min-h-36 group"
    >
      <div class="absolute z-30 top-3 right-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="gray" class="w-4 h-4 group-hover:stroke-blue-500">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
        </svg>        
      </div>
      <div class="flex justify-center left-info-box-text">
        <div class="flex flex-col justify-center align-middle lg:min-h-36">
          <h4 class="text-4xl font-semibold text-center font-display">
            {{ project_count }}
          </h4>
          <p>projects</p>
        </div>
      </div>
    </div>
  </a>

  <a href="/components/" class="block middle-info-box">
    <div
      style="padding: 1.5rem"
      class="relative flex flex-col justify-center w-full p-6 border-b border-gray-200 border-x md:border-t md:border-x-0 h-52 md:h-full group"
    >
      <div class="absolute z-30 top-3 right-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="gray" class="w-4 h-4 group-hover:stroke-blue-500">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
        </svg>        
      </div>
      <div class="flex justify-center middle-info-box-text">
        <div class="flex flex-col justify-center align-middle lg:min-h-36">
          <h4 class="text-4xl font-semibold text-center font-display">
            {{ component_count }}
          </h4>
          <p>components</p>
        </div>
      </div>
    </div>
  </a>

  <div
    class="flex flex-col justify-center w-full p-6 border-b border-gray-200 border-x md:border-t right-info-box h-52 md:h-full"
  >
    <div class="flex justify-center">
      <div class="flex flex-col justify-center align-middle lg:min-h-36">
        <h4 class="text-4xl font-semibold text-center font-display">
          {{ manufacturer_count }}
        </h4>
        <p>manufacturers</p>
      </div>
    </div>
  </div>

  <div
    class="flex flex-col justify-between w-full h-full space-y-12 border-b border-gray-200 border-x about-section"
  >
    <div
      style="
        -webkit-mask: linear-gradient(
            to top,
            rgba(0, 0, 0, 0) 10%,
            rgba(0, 0, 0, 1) 10%,
            rgba(0, 0, 0, 1) 90%,
            rgba(0, 0, 0, 0) 100%
          ),
          linear-gradient(
            to left,
            rgba(0, 0, 0, 0) 0%,
            rgba(0, 0, 0, 1) 10%,
            rgba(0, 0, 0, 1) 90%,
            rgba(0, 0, 0, 0) 100%
          );
        mask: linear-gradient(
            to top,
            rgba(0, 0, 0, 0) 0%,
            rgba(0, 0, 0, 1) 10%,
            rgba(0, 0, 0, 1) 90%,
            rgba(0, 0, 0, 0) 100%
          ),
          linear-gradient(
            to left,
            rgba(0, 0, 0, 0) 0%,
            rgba(0, 0, 0, 1) 10%,
            rgba(0, 0, 0, 1) 90%,
            rgba(0, 0, 0, 0) 100%
          );
        -webkit-mask-composite: destination-in;
        mask-composite: intersect;
        background: white;
      "
    >
      <div
        style="
          background: linear-gradient(
              -90deg,
              rgba(0, 0, 0, 0.05) 1px,
              transparent 1px
            ),
            linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
            linear-gradient(-90deg, rgba(0, 0, 0, 0.04) 1px, transparent 1px),
            linear-gradient(rgba(0, 0, 0, 0.04) 1px, transparent 1px),
            linear-gradient(
              transparent 3px,
              #fff 3px,
              #fff 98px,
              transparent 98px
            ),
            linear-gradient(-90deg, #aaa 1px, transparent 1px),
            linear-gradient(
              -90deg,
              transparent 3px,
              #fff 3px,
              #fff 98px,
              transparent 98px
            ),
            linear-gradient(#aaa 1px, transparent 1px), #f2f2f2;
          background-size: 10px 10px, 10px 10px, 100px 100px, 100px 100px,
            100px 100px, 100px 100px, 100px 100px, 100px 100px;
          background-position: 10px 20px, 10px 20px, 40px 20px, 40px 20px,
            40px 20px, 40px 20px, 40px 20px, 40px 20px;
        "
      >
        <div
          style="padding: 1.5rem"
          class="items-center justify-between w-full h-full p-6 border-gray-200 info1-section"
        >
          <div
            class="flex flex-col h-full gap-4 p-6 rounded-lg md:gap-6 md:flex-row"
          >
            <div
              class="flex flex-col justify-center w-full h-full gap-2 p-3 md:w-4/5 lg:w-3/5 lg:p-10"
            >
              <div>
                <h1
                  class="mb-2 text-xl font-semibold text-center text-gray-800 font-display md:text-left"
                >
                  Virtual DIY Synth Kits for DIY Guitar Pedals and DIY Eurorack
                  Modules With Simple Tools and Tutorials
                </h1>
              </div>
              <div class="block sm:hidden xl:block">
                <p
                  class="mb-4 text-sm text-center text-gray-600 font-display md:text-left"
                >
                  BOM Squad is a free inventory and component aggregator
                  designed for DIY audio hardware builders. It offers a
                  comprehensive suite of tools, tutorials, and community
                  insights to streamline your projects.
                </p>
              </div>
              <div class="flex justify-center w-full md:justify-start">
                <a class="w-auto md:w-full" href="/projects/">
                  <button
                    type="button"
                    class="px-4 py-1.5 text-sm font-semibold text-white bg-blue-600 min-w-2/5 whitespace-nowrap sm:min-w-3/5 lg:min-w-3/5 hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"
                  >
                    See projects
                  </button>
                </a>
              </div>
            </div>
            <div class="flex items-center justify-center w-full">
              <div
                class="youtube-placeholder"
                style="
                  position: relative;
                  width: 100%;
                  aspect-ratio: 16/9;
                  background: url('https://img.youtube.com/vi/ddtQrfLwvgs/hqdefault.jpg')
                    center/cover no-repeat;
                "
              >
                <button
                  style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 50px;
                    height: 50px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 18px;
                  "
                  onclick="loadYoutubeIframe(this)"
                >
                  ▶
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Blog Row -->
  <div class="w-full px-6 py-8 border-gray-200 border-x blog-section">
    <div class="flex items-center justify-center w-full mb-8">
      <div class="px-5 py-3 border border-gray-200">
        <h2 class="text-2xl font-semibold text-gray-900 font-display">
          Latest Blog Posts
        </h2>
      </div>
    </div>
    <div class="grid gap-8 {% if blog_posts|length > 1 %} md:grid-cols-2 {% else %} place-items-center {% endif %}">
      {% for post in blog_posts %}
        <div class="flex flex-col overflow-hidden bg-white w-full {% if blog_posts|length == 1 %} max-w-lg {% endif %}">
          <!-- Blog Post Thumbnail -->
          <a href="{{ post.post_url }}" class="relative">
            <picture>
              <source srcset="{{ post.thumbnail }}" type="image/webp" />
              <img src="{{ post.thumbnail }}" alt="{{ post.title }}" class="object-cover w-full h-48 rounded-lg">
            </picture>
          </a>
  
          <!-- Blog Post Content -->
          <div class="py-6">
            <h3 class="text-xl font-semibold">
              <a href="{{ post.post_url }}" class="text-gray-900 hover:text-blue-600">
                {{ post.title }}
              </a>
            </h3>
            <p class="mt-2 text-gray-700 text-md">
              {{ post.excerpt }}
            </p>
            <div class="mt-4">
              <a href="{{ post.post_url }}" class="font-medium text-blue-500 hover:underline">
                Read more →
              </a>
            </div>
          </div>
        </div>
      {% empty %}
        <p class="text-center text-gray-500">No recent blog posts available.</p>
      {% endfor %}
    </div>
  </div>

  <div class="flex flex-col cheaper-box md:flex-row">
    <div
      style="padding: 1.5rem"
      class="relative flex flex-col justify-center w-full p-6 overflow-hidden border-t border-b border-gray-200 border-x md:border-b-0 h-52 group"
      role="button"
    >
      <div class="absolute z-30 top-3 right-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="gray" class="w-4 h-4 group-hover:stroke-blue-500">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
        </svg>        
      </div>
      <div class="flex justify-center slide-in-left">
        <div class="flex flex-col justify-center align-middle lg:min-h-36">
          <div class="text-center">Self-sourcing components is</div>
          <div class="my-3 text-4xl font-semibold text-center font-display">
            {{ diy_savings_stats.pcb_only_vs_assembled.median_savings }}%
          </div>
          <div class="text-center">cheaper than buying pre-assembled</div>
        </div>
      </div>
    </div>

    <div
      style="padding: 1.5rem"
      class="relative flex flex-col justify-center w-full p-6 overflow-hidden border-gray-200 border-x md:border-t md:border-r md:border-x-0 h-52 group"
      role="button"
    >
      <div class="absolute z-30 top-3 right-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="gray" class="w-4 h-4 group-hover:stroke-blue-500">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
        </svg>        
      </div>
      <div class="flex justify-center slide-in-right">
        <div class="flex flex-col justify-center align-middle lg:min-h-36">
          <div class="text-center">Self-sourcing components is</div>
          <div class="my-3 text-4xl font-semibold text-center font-display">
            {{ diy_savings_stats.pcb_plus_front_vs_kit.median_savings }}%
          </div>
          <div class="text-center">cheaper than building from a kit</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Info Row 1 -->
  <div
    class="flex flex-col justify-between w-full h-full space-y-12 border-t border-gray-200 border-x info1-section"
  >
    <div
      style="padding: 1.5rem"
      class="flex flex-col items-center justify-between w-full h-full p-6 border-gray-200 lg:flex-row info1-section"
    >
      <!-- Text Section -->
      <div class="w-full text-center lg:mb-0 lg:mr-6 lg:w-1/2 md:text-left">
        <h3
          class="mb-2 text-2xl font-semibold text-center text-gray-800 font-display md:text-left"
        >
          Subscribe for updates
        </h3>
        <p
          class="mb-4 text-sm text-center text-gray-600 font-display md:text-left"
        >
          Stay updated with the latest BOM Squad projects and community news!
        </p>
        {% if messages %}
        <div class="mt-4 text-sm text-gray-600">
          {% for message in messages %}
          <p>{{ message }}</p>
          {% endfor %}
        </div>
        {% endif %}
      </div>

      <!-- Form Section -->
      <form
        method="post"
        action="{% url 'subscription' %}"
        class="flex flex-col items-center w-full space-y-3 lg:w-1/2"
      >
        {% csrf_token %}
        <div class="flex w-full mb-3 space-x-2">
          <input
            type="email"
            name="email"
            placeholder="Enter your email"
            class="w-5/6 p-2 rounded md:border md:border-gray-300 focus:outline-none focus:md:border-gray-400 grow-1"
          />
          <button
            type="submit"
            class="w-auto px-4 py-2 text-white rounded bg-brandgreen-500 hover:bg-brandgreen-700 font-display"
          >
            Subscribe
          </button>
        </div>
      </form>
    </div>
    <div style="margin: 0" class="relative py-2">
      <svg width="100%" height="1" style="position: absolute; top: 0; left: 0">
        <line
          x1="0"
          y1="0.5"
          x2="100%"
          y2="0.5"
          stroke="#9ca3af"
          stroke-width="1"
          stroke-dasharray="8, 16"
        />
      </svg>
    </div>
  </div>

  <!-- Info Row 2 - Spanning all columns with Product Image and Text -->
  <div
    class="relative flex flex-col items-center justify-center w-full p-8 border-gray-200 border-x md:border-b md:border-l md:-space-y-4 info2-section md:flex-row md:justify-between md:space-x-6"
  >
    <a href="https://bom-squad.printify.me/" class="absolute inset-0 z-10"></a>
    <!-- Product Image -->
    <div
      class="flex justify-center w-full mb-4 align-middle md:w-1/2 lg:w-1/3 md:mb-0"
    >
      <picture>
        <img
          src="{% static 'images/folded.jpg' %}"
          alt="BOM Squad Merch"
          class="object-cover w-48 h-auto md:w-full"
        />
      </picture>
    </div>

    <!-- Text Section -->
    <div class="flex flex-col items-start w-full space-y-2 grow-1">
      <h3
        style="font-size: 18px"
        class="w-full text-2xl font-bold text-center text-gray-800 font-display md:text-left"
      >
        BOM Squad merch now available!
      </h3>
      <p
        style="font-size: 14px"
        class="font-normal text-center text-gray-600 text-md md:text-left"
      >
        Support BOM Squad by grabbing exclusive merch to show your passion for
        the DIY community!
      </p>
    </div>
  </div>

  <!-- Footer Section -->
  <div
    style="padding: 0.75rem"
    class="relative flex flex-col items-center justify-center w-full p-3 border border-gray-200 md:border-b md:border-l-0 md:border-r md:border-t-0 footer-section"
  >
    <a
      href="https://github.com/PleatherStarfish/bomsquad"
      class="absolute inset-0 z-10"
    ></a>
    <!-- Content Section -->
    <div
      style="padding: 1rem"
      class="flex flex-col items-center w-full h-full p-4 space-y-3 text-center bg-[#cab9a3] rounded"
    >
      <img
        src="{% static 'images/github.svg' %}"
        alt="GitHub logo"
        class="w-9 h-9 lg:w-11 lg:h-11"
      />
      <p class="text-white">
        BOM Squad is free and open source! Contribute to the project on GitHub!
      </p>
    </div>
  </div>
</div>

<div class="w-full px-4 py-6 md:px-0">
  <script
    async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1549230942850511"
    crossorigin="anonymous"
  ></script>
  <!-- Horizontal #1 -->
  <ins
    class="adsbygoogle"
    style="display: block"
    data-ad-client="ca-pub-1549230942850511"
    data-ad-slot="6605122203"
    data-ad-format="auto"
    data-full-width-responsive="true"
  ></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

{% endblock content %} {% block javascript %}
<script>
  window.addEventListener("scroll", function () {
    const parallaxImage = document.getElementById("parallax-image");
    const scrollPosition = window.scrollY;

    // Adjust the image's transform for the parallax effect
    parallaxImage.style.transform = `translateY(${scrollPosition * 0.3}px)`;
  });
</script>
<script>
  const audioElement = document.getElementById("audio-jiggle");
  const parallaxImage = document.getElementById("parallax-container");
  let lastMouseMoveTime = 0;
  let lastMouseX = 0;
  let lastMouseY = 0;

  // Calculate mouse speed and movement angle
  function calculateMouseSpeedAndAngle(event) {
    const now = performance.now();
    const elapsedTime = now - (lastMouseMoveTime || now);

    const deltaX = event.clientX - (lastMouseX || event.clientX);
    const deltaY = event.clientY - (lastMouseY || event.clientY);
    const distance = Math.sqrt(deltaX ** 2 + deltaY ** 2);
    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI); // Convert to degrees

    lastMouseMoveTime = now;
    lastMouseX = event.clientX;
    lastMouseY = event.clientY;

    // Calculate speed and map it using the range formula
    const speed = elapsedTime > 0 ? distance / elapsedTime : 0;

    const xMax = 10; // Maximum perturbation
    const xMin = 1; // Minimum perturbation
    const yMax = 559.22; // Maximum speed
    const yMin = 300.77; // Minimum speed

    const clampedSpeed = Math.max(yMin, Math.min(speed, yMax));
    const percent = (clampedSpeed - yMin) / (yMax - yMin);
    const perturbationIntensity = percent * (xMax - xMin) + xMin;

    return {
      speed: perturbationIntensity,
      angle: isNaN(angle) ? 0 : angle,
    };
  }

  function generateKeyframes(scale, rotateX, rotateY, skewX, skewY) {
    // Function to clamp values between a minimum and maximum range
    const clamp = (value, min, max) => Math.max(min, Math.min(value, max));

    // Define ranges for the multipliers
    const scaleMin = 1,
      scaleMax = 2; // Scale should vary between 1 (no change) and max scale
    const rotateMin = -45,
      rotateMax = 45; // Rotation should stay within -45 to 45 degrees
    const skewMin = -10,
      skewMax = 10; // Skew should stay within -10 to 10 degrees

    return `
      @keyframes dynamicSpringBounce {
        0% {
          transform: scale(1) rotateX(0deg) rotateY(0deg) skew(0deg, 0deg) translate(0px, 0px);
        }
        35% {
          transform: scale(${clamp(scale * 2, scaleMin, scaleMax)}) 
                    rotateX(${clamp(rotateX, rotateMin, rotateMax)}deg) 
                    rotateY(${clamp(rotateY, rotateMin, rotateMax)}deg) 
                    skew(${clamp(skewX, skewMin, skewMax)}deg, ${clamp(
      skewY,
      skewMin,
      skewMax
    )}deg) 
                    translate(2px, -2px);
        }
        60% {
          transform: scale(${clamp(scale * 0.7, scaleMin, scaleMax)}) 
                    rotateX(${clamp(rotateX * -0.8, rotateMin, rotateMax)}deg) 
                    rotateY(${clamp(rotateY * -0.8, rotateMin, rotateMax)}deg) 
                    skew(${clamp(skewX * -0.7, skewMin, skewMax)}deg, ${clamp(
      skewY * 0.7,
      skewMin,
      skewMax
    )}deg) 
                    translate(-3px, 3px);
        }
        80% {
          transform: scale(${clamp(scale * 1.3, scaleMin, scaleMax)}) 
                    rotateX(${clamp(rotateX * 0.6, rotateMin, rotateMax)}deg) 
                    rotateY(${clamp(rotateY * 0.6, rotateMin, rotateMax)}deg) 
                    skew(${clamp(skewX * 0.5, skewMin, skewMax)}deg, ${clamp(
      skewY * -0.5,
      skewMin,
      skewMax
    )}deg) 
                    translate(1px, -1px);
        }
        95% {
          transform: scale(${clamp(scale * 0.95, scaleMin, scaleMax)}) 
                    rotateX(${clamp(rotateX * -0.4, rotateMin, rotateMax)}deg) 
                    rotateY(${clamp(rotateY * -0.4, rotateMin, rotateMax)}deg) 
                    skew(${clamp(skewX * -0.3, skewMin, skewMax)}deg, ${clamp(
      skewY * 0.3,
      skewMin,
      skewMax
    )}deg) 
                    translate(-1px, 1px);
        }
        100% {
          transform: scale(1) rotateX(0deg) rotateY(0deg) skew(0deg, 0deg) translate(0px, 0px);
        }
      }
    `;
  }

  function triggerAnimation(event) {
    const { speed, angle } = calculateMouseSpeedAndAngle(event);

    // Adjust the range and sensitivity for scaleIntensity
    const scaleBase = 1; // Base scale
    const maxScaleFactor = 3; // Increase max scale for greater variability
    const scaleSensitivity = 0.2; // Increase sensitivity for more noticeable differences

    // Calculate scaleIntensity with more dynamic variability
    const scaleIntensity = Math.min(
      scaleBase + Math.pow(speed * scaleSensitivity, 1),
      maxScaleFactor
    );

    // Rotation: Enhance variability by scaling based on speed and angle
    const rotationScalingFactor = 75; // Increase factor for more rotation variability
    const rotateXIntensity =
      Math.sin((angle * Math.PI) / 180) *
      Math.min(speed * rotationScalingFactor, 45);
    const rotateYIntensity =
      Math.cos((angle * Math.PI) / 180) *
      Math.min(speed * rotationScalingFactor, 45);

    // Skew: Adjust intensities to reflect higher variability
    const skewXIntensity = Math.min(speed * 1.5, 15); // Increase cap to 15 for more noticeable skew
    const skewYIntensity = Math.min(speed * 1.2, 12); // Increase cap to 12 for more variability

    // Generate keyframes dynamically
    const keyframes = generateKeyframes(
      scaleIntensity,
      rotateXIntensity,
      rotateYIntensity,
      skewXIntensity,
      skewYIntensity
    );

    // Inject or update the keyframes in the stylesheet
    const styleSheet =
      document.head.querySelector("style") || document.createElement("style");
    if (!styleSheet.parentElement) document.head.appendChild(styleSheet);

    [...styleSheet.sheet.rules].forEach((rule, i) => {
      if (rule.name === "dynamicSpringBounce") {
        styleSheet.sheet.deleteRule(i);
      }
    });

    styleSheet.sheet.insertRule(keyframes, styleSheet.sheet.cssRules.length);

    // Restart animation
    audioElement.style.animation = "none";
    void audioElement.offsetWidth; // Trigger reflow
    audioElement.style.animation = "dynamicSpringBounce 0.8s ease-in"; // Reapply animation
  }

  parallaxImage.addEventListener("mouseenter", triggerAnimation);
</script>
<script>
  function loadYoutubeIframe(button) {
    const container = button.parentElement;
    const iframe = document.createElement("iframe");
    iframe.style.width = "100%";
    iframe.style.aspectRatio = "16/9";
    iframe.src =
      "https://www.youtube.com/embed/ddtQrfLwvgs?si=ApisRqfA7PxR-v_9";
    iframe.title = "YouTube video player";
    iframe.frameBorder = "0";
    iframe.allow =
      "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
    iframe.allowFullscreen = true;
    iframe.referrerPolicy = "strict-origin-when-cross-origin";
    container.innerHTML = "";
    container.appendChild(iframe);
  }
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const elementsLeft = document.querySelectorAll(".slide-in-left");
    const elementsRight = document.querySelectorAll(".slide-in-right");

    function handleScroll() {
      const triggerHeight = window.innerHeight * 0.85; // Trigger when element is 85% in view

      elementsLeft.forEach((el) => {
        const rect = el.getBoundingClientRect();
        if (rect.top < triggerHeight) {
          el.classList.add("show");
        }
      });

      elementsRight.forEach((el) => {
        const rect = el.getBoundingClientRect();
        if (rect.top < triggerHeight) {
          el.classList.add("show");
        }
      });
    }

    // Run on scroll
    window.addEventListener("scroll", handleScroll);

    // Run on load in case elements are already in view
    handleScroll();
  });
</script>

{% endblock javascript %}

{% block css %}
<style>
  .savings-section {
    position: relative;
    background-image: url("{% static 'images/electronics_diagram_background_square.jpeg' %}");
    background-size: cover;
    background-position: center;
  }

  .savings-section::before {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.8);
    z-index: 1;
  }

  .savings-content {
    position: relative;
    z-index: 2;
    background: rgba(255, 255, 255);
    border-radius: 8px;
  }
  /* Initial state for left and right elements */
  .slide-in-left,
  .slide-in-right {
    opacity: 0;
    transform: translateX(-500px);
    transition: opacity 0.8s ease-out, transform 0.8s cubic-bezier(0.25, 1, 0.5, 1);
  }

  .slide-in-right {
    transform: translateX(500px);
  }

  /* When in view, animate into position */
  .show {
    opacity: 1;
    transform: translateX(0);
  }

  /* Hover effect: Grow slightly */
  .slide-in-left:hover,
  .slide-in-right:hover,
  .left-info-box-text:hover,
  .middle-info-box-text:hover
   {
    transform: scale(1.05); /* Slight enlargement */
    transition: transform 0.4s ease-out; /* Smooth transition */
  }
</style>
{% endblock css %}

